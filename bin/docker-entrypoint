#!/bin/bash
set -e

# Debug: Show if variable is set
echo "GOOGLE_CLIENT_SECRET_JSON is set: $[ -n "$GOOGLE_CLIENT_SECRET_JSON" ] && echo 'YES' || echo 'NO'"

if [ -n "$GOOGLE_CLIENT_SECRET_JSON" ]; then
  echo "$GOOGLE_CLIENT_SECRET_JSON" > /tmp/client_secret.json
  echo "client_secret.json created in /tmp"
  ls -la /tmp/client_secret.json
else
  echo "WARNING: GOOGLE_CLIENT_SECRET_JSON not set â€” using dummy"
fi

export GOOGLE_CLIENT_SECRET_PATH="/tmp/client_secret.json"

bundle exec rails db:migrate

exec bundle exec rails server -b 0.0.0.0 -p 80