#!/bin/bash
set -e

# === 1. Create real client_secret.json from Railway ENV ===
if [ -n "$GOOGLE_CLIENT_SECRET_JSON" ]; then
  echo "$GOOGLE_CLIENT_SECRET_JSON" > /rails/client_secret.json
  echo "client_secret.json created from ENV"
else
  echo "WARNING: GOOGLE_CLIENT_SECRET_JSON not set â€” using dummy"
fi

# === 2. Run migrations ===
bundle exec rails db:migrate

# === 3. Start server ===
exec bundle exec rails server -b 0.0.0.0 -p 80