#!/bin/bash
set -e

echo "GOOGLE_CLIENT_SECRET_JSON is set: $([ -n "$GOOGLE_CLIENT_SECRET_JSON" ] && echo 'YES' || echo 'NO')"

export GOOGLE_CLIENT_SECRET_PATH="/tmp/client_secret.json"

bundle exec rails db:migrate

# Use Railway's PORT env var (default to 80 if not set)
PORT=${PORT:-80}
exec bundle exec rails server -b 0.0.0.0 -p $PORT